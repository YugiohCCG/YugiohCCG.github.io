import{j as c,u as be}from"./index-CW3kYlzI.js";import{u as se,b as z}from"./react-BJTGk-tB.js";import{u as fe,C as Te}from"./CardTile-BUHjHFJP.js";import{F as Me}from"./search-Ch1WBRTM.js";import{a as Re}from"./assets-BkOAQMwM.js";const ke={keys:["name","archetype","set","category","attribute","text","keywords","monsterType","cardTypes"],threshold:.35,ignoreLocation:!0,includeScore:!1,useExtendedSearch:!1,minMatchCharLength:2};function Oe(t){return new Me(t,ke)}function Ne(t){const e=t.legal;return e?e.banned?"banned":e.limited?"limited":e.semiLimited?"semi":"legal":null}const J=t=>(t??"").toString().trim().toUpperCase(),oe=t=>(Array.isArray(t)?t:[]).map(e=>J(e)).filter(Boolean);function Y(t,e){if(!e||e.length===0)return!0;const r=J(t);return new Set(oe(e)).has(r)}function ue(t,e){if(!t||t.length===0)return!0;const r=new Set(oe(e));return oe(t).every(o=>r.has(o))}function B(t,e,r){return e==null&&r==null?!0:!(t==null||e!=null&&t<e||r!=null&&t>r)}function je(t){const e=J(t);return e==="BANNED"||e==="FORBIDDEN"?"banned":e==="LIMITED"||e==="LIMIT"?"limited":e==="SEMI-LIMITED"||e==="SEMILIMITED"||e==="SEMI"?"semi":e==="UNLIMITED"||e==="LEGAL"?"legal":null}function de(t){const e=String(t).toUpperCase().trim(),r={1:"TL",2:"T",3:"TR",4:"L",6:"R",7:"BL",8:"B",9:"BR"};return r[e]?r[e]:e}function Le(t,e){if(e.set&&e.set.length&&!Y(t.set,e.set)||e.archetype&&e.archetype.length&&!Y(t.archetype,e.archetype)||e.category&&J(t.category)!==J(e.category)||e.icon&&e.icon.length&&!Y(t.icon,e.icon)||!ue(e.cardTypes,t.cardTypes||null)||!ue(e.monsterType,t.monsterType||null)||e.attribute&&e.attribute.length&&!Y(t.attribute,e.attribute)||!B(t.level??null,e.levelMin,e.levelMax)||!B(t.rank??null,e.rankMin,e.rankMax)||!B(t.linkRating??null,e.linkMin,e.linkMax)||!B(t.scale??null,e.scaleMin,e.scaleMax)||!B(t.atk??null,e.atkMin,e.atkMax)||!B(t.def??null,e.defMin,e.defMax))return!1;if(e.linkArrows&&e.linkArrows.length){const r=new Set((t.linkArrows??[]).map(l=>de(l))),o=new Set(e.linkArrows.map(l=>de(l)));for(const l of o)if(!r.has(l))return!1}if(e.legal&&e.legal.length){const r=new Set(e.legal.map(je).filter(o=>!!o));if(r.size){const o=Ne(t);if(!o||!r.has(o))return!1}}return!0}function Pe(t,e,r){const o=r==="desc"?-1:1,l=(m,w)=>m===w?0:m>w?1:-1,p=m=>[...t].sort((w,S)=>{const I=m(w),b=m(S),f=I==null,g=b==null;return f&&g?0:f?1:g?-1:o*l(I,b)});switch(e){case"atk":return p(m=>m.atk??null);case"def":return p(m=>m.def??null);case"level":return p(m=>m.level??null);case"rank":return p(m=>m.rank??null);case"link":return p(m=>m.linkRating??null);case"date":return p(m=>m.timestamps?.added??"");case"name":default:return p(m=>(m.name||"").toLowerCase())}}function ze(){const{indexes:t}=fe(),[e,r]=se(),o=e.get("filters")==="0",[l,p]=z.useState(o),[m,w]=z.useState(e.get("q")||""),[S,I]=z.useState(e.get("set")||"");z.useEffect(()=>{w(e.get("q")||"")},[e]);const b=z.useMemo(()=>t.setsList??[],[t.setsList]),f=(s,d)=>{d?e.set(s,d):e.delete(s)},g=()=>{f("q",m.trim()||null),f("set",S||null),e.set("filters",l?"0":"1"),r(e,{replace:!0})},T=()=>{const s=l?"0":"1";r(new URLSearchParams({filters:s}),{replace:!0}),w(""),I("")},R=s=>{s.preventDefault(),g()},i=()=>{const s=!l;p(s),e.set("filters",s?"0":"1"),r(e,{replace:!0})};return c.jsxs("div",{className:"card mb-4 p-3 rounded-2xl bg-neutral-900 border border-neutral-800",children:[c.jsxs("form",{className:"flex flex-col gap-2 md:flex-row md:items-center",onSubmit:R,children:[c.jsx("input",{placeholder:"Search keyword/name/text…",value:m,onChange:s=>w(s.target.value),className:"flex-1 bg-neutral-800 border border-neutral-700 rounded-lg px-3 py-2 text-sm"}),c.jsxs("select",{className:"bg-neutral-800 border border-neutral-700 rounded-lg px-2.5 py-2 text-sm min-w-[12rem]",value:S,onChange:s=>I(s.target.value),children:[c.jsx("option",{value:"",children:"All Sets"}),b.map(s=>c.jsx("option",{value:s.code,children:s.code},s.code))]}),c.jsxs("div",{className:"flex gap-2 md:ml-2",children:[c.jsx("button",{type:"button",className:"btn",onClick:i,children:l?"Show Filters":"Hide Filters"}),c.jsx("button",{type:"button",className:"btn",onClick:T,children:"Reset"}),c.jsx("button",{type:"submit",className:"btn btn-primary",children:"Apply"})]})]}),!l&&c.jsx("div",{className:"mt-3 text-sm text-neutral-400"})]})}const Z=[{key:"name",label:"Name",defaultDir:"asc"},{key:"date",label:"Date Added",defaultDir:"desc"},{key:"atk",label:"ATK",defaultDir:"desc"},{key:"def",label:"DEF",defaultDir:"desc"},{key:"level",label:"Level",defaultDir:"desc"},{key:"rank",label:"Rank",defaultDir:"desc"},{key:"link",label:"Link",defaultDir:"desc"}];function _e({total:t}){const[e,r]=se(),o=e.get("view")||"grid",l=e.get("sort")||"name",p=Z.find(f=>f.key===l)||Z[0],w=e.get("dir")??p.defaultDir,S=f=>{const g=new URLSearchParams(e);if(f===l)g.set("dir",w==="asc"?"desc":"asc");else{g.set("sort",f);const T=Z.find(R=>R.key===f)?.defaultDir??"asc";g.set("dir",T)}r(g,{replace:!0})},I=f=>{const g=new URLSearchParams(e);g.set("view",f),r(g,{replace:!0})},b=f=>f!==l?null:c.jsx("span",{className:"ml-1",children:w==="asc"?"↑":"↓"});return c.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between mb-4",children:[c.jsxs("div",{className:"text-sm text-neutral-400",children:[t.toLocaleString()," cards"]}),c.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[c.jsx("div",{className:"flex flex-wrap gap-1 bg-neutral-900 border border-neutral-700 rounded-xl p-1",children:Z.map(f=>c.jsxs("button",{onClick:()=>S(f.key),className:"px-3 py-1.5 rounded-lg text-sm transition "+(l===f.key?"bg-accent text-white":"bg-transparent text-neutral-300 hover:bg-neutral-800"),title:`Sort by ${f.label}`,children:[f.label,b(f.key)]},f.key))}),c.jsxs("div",{className:"flex gap-1 bg-neutral-900 border border-neutral-700 rounded-xl p-1",children:[c.jsx("button",{className:`px-3 py-1.5 rounded-lg text-sm ${o==="grid"?"bg-accent text-white":"text-neutral-300 hover:bg-neutral-800"}`,onClick:()=>I("grid"),children:"Grid"}),c.jsx("button",{className:`px-3 py-1.5 rounded-lg text-sm ${o==="list"?"bg-accent text-white":"text-neutral-300 hover:bg-neutral-800"}`,onClick:()=>I("list"),children:"List"})]})]})]})}function q(){return q=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var o in r)({}).hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},q.apply(null,arguments)}function ee(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ie(t,e){return ie=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,o){return r.__proto__=o,r},ie(t,e)}function pe(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,ie(t,e)}var he=Number.isNaN||function(e){return typeof e=="number"&&e!==e};function We(t,e){return!!(t===e||he(t)&&he(e))}function De(t,e){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(!We(t[r],e[r]))return!1;return!0}function G(t,e){e===void 0&&(e=De);var r,o=[],l,p=!1;function m(){for(var w=[],S=0;S<arguments.length;S++)w[S]=arguments[S];return p&&r===this&&e(w,o)||(l=t.apply(this,w),p=!0,r=this,o=w),l}return m}var Fe=typeof performance=="object"&&typeof performance.now=="function",me=Fe?function(){return performance.now()}:function(){return Date.now()};function te(t){cancelAnimationFrame(t.id)}function ge(t,e){var r=me();function o(){me()-r>=e?t.call(null):l.id=requestAnimationFrame(o)}var l={id:requestAnimationFrame(o)};return l}var re=-1;function le(t){if(t===void 0&&(t=!1),re===-1||t){var e=document.createElement("div"),r=e.style;r.width="50px",r.height="50px",r.overflow="scroll",document.body.appendChild(e),re=e.offsetWidth-e.clientWidth,document.body.removeChild(e)}return re}var V=null;function ne(t){if(t===void 0&&(t=!1),V===null||t){var e=document.createElement("div"),r=e.style;r.width="50px",r.height="50px",r.overflow="scroll",r.direction="rtl";var o=document.createElement("div"),l=o.style;return l.width="100px",l.height="100px",e.appendChild(o),document.body.appendChild(e),e.scrollLeft>0?V="positive-descending":(e.scrollLeft=1,e.scrollLeft===0?V="negative":V="positive-ascending"),document.body.removeChild(e),V}return V}var Ee=150,Ae=function(e){var r=e.columnIndex;e.data;var o=e.rowIndex;return o+":"+r};function He(t){var e,r=t.getColumnOffset,o=t.getColumnStartIndexForOffset,l=t.getColumnStopIndexForStartIndex,p=t.getColumnWidth,m=t.getEstimatedTotalHeight,w=t.getEstimatedTotalWidth,S=t.getOffsetForColumnAndAlignment,I=t.getOffsetForRowAndAlignment,b=t.getRowHeight,f=t.getRowOffset,g=t.getRowStartIndexForOffset,T=t.getRowStopIndexForStartIndex,R=t.initInstanceProps,i=t.shouldResetStyleCacheOnItemSizeChange,s=t.validateProps;return e=function(d){pe(h,d);function h(C){var n;return n=d.call(this,C)||this,n._instanceProps=R(n.props,ee(n)),n._resetIsScrollingTimeoutId=null,n._outerRef=void 0,n.state={instance:ee(n),isScrolling:!1,horizontalScrollDirection:"forward",scrollLeft:typeof n.props.initialScrollLeft=="number"?n.props.initialScrollLeft:0,scrollTop:typeof n.props.initialScrollTop=="number"?n.props.initialScrollTop:0,scrollUpdateWasRequested:!1,verticalScrollDirection:"forward"},n._callOnItemsRendered=void 0,n._callOnItemsRendered=G(function(a,u,v,M,y,k,N,P){return n.props.onItemsRendered({overscanColumnStartIndex:a,overscanColumnStopIndex:u,overscanRowStartIndex:v,overscanRowStopIndex:M,visibleColumnStartIndex:y,visibleColumnStopIndex:k,visibleRowStartIndex:N,visibleRowStopIndex:P})}),n._callOnScroll=void 0,n._callOnScroll=G(function(a,u,v,M,y){return n.props.onScroll({horizontalScrollDirection:v,scrollLeft:a,scrollTop:u,verticalScrollDirection:M,scrollUpdateWasRequested:y})}),n._getItemStyle=void 0,n._getItemStyle=function(a,u){var v=n.props,M=v.columnWidth,y=v.direction,k=v.rowHeight,N=n._getItemStyleCache(i&&M,i&&y,i&&k),P=a+":"+u,j;if(N.hasOwnProperty(P))j=N[P];else{var L=r(n.props,u,n._instanceProps),O=y==="rtl";N[P]=j={position:"absolute",left:O?void 0:L,right:O?L:void 0,top:f(n.props,a,n._instanceProps),height:b(n.props,a,n._instanceProps),width:p(n.props,u,n._instanceProps)}}return j},n._getItemStyleCache=void 0,n._getItemStyleCache=G(function(a,u,v){return{}}),n._onScroll=function(a){var u=a.currentTarget,v=u.clientHeight,M=u.clientWidth,y=u.scrollLeft,k=u.scrollTop,N=u.scrollHeight,P=u.scrollWidth;n.setState(function(j){if(j.scrollLeft===y&&j.scrollTop===k)return null;var L=n.props.direction,O=y;if(L==="rtl")switch(ne()){case"negative":O=-y;break;case"positive-descending":O=P-M-y;break}O=Math.max(0,Math.min(O,P-M));var _=Math.max(0,Math.min(k,N-v));return{isScrolling:!0,horizontalScrollDirection:j.scrollLeft<y?"forward":"backward",scrollLeft:O,scrollTop:_,verticalScrollDirection:j.scrollTop<k?"forward":"backward",scrollUpdateWasRequested:!1}},n._resetIsScrollingDebounced)},n._outerRefSetter=function(a){var u=n.props.outerRef;n._outerRef=a,typeof u=="function"?u(a):u!=null&&typeof u=="object"&&u.hasOwnProperty("current")&&(u.current=a)},n._resetIsScrollingDebounced=function(){n._resetIsScrollingTimeoutId!==null&&te(n._resetIsScrollingTimeoutId),n._resetIsScrollingTimeoutId=ge(n._resetIsScrolling,Ee)},n._resetIsScrolling=function(){n._resetIsScrollingTimeoutId=null,n.setState({isScrolling:!1},function(){n._getItemStyleCache(-1)})},n}h.getDerivedStateFromProps=function(n,a){return Ue(n,a),s(n),null};var x=h.prototype;return x.scrollTo=function(n){var a=n.scrollLeft,u=n.scrollTop;a!==void 0&&(a=Math.max(0,a)),u!==void 0&&(u=Math.max(0,u)),this.setState(function(v){return a===void 0&&(a=v.scrollLeft),u===void 0&&(u=v.scrollTop),v.scrollLeft===a&&v.scrollTop===u?null:{horizontalScrollDirection:v.scrollLeft<a?"forward":"backward",scrollLeft:a,scrollTop:u,scrollUpdateWasRequested:!0,verticalScrollDirection:v.scrollTop<u?"forward":"backward"}},this._resetIsScrollingDebounced)},x.scrollToItem=function(n){var a=n.align,u=a===void 0?"auto":a,v=n.columnIndex,M=n.rowIndex,y=this.props,k=y.columnCount,N=y.height,P=y.rowCount,j=y.width,L=this.state,O=L.scrollLeft,_=L.scrollTop,W=le();v!==void 0&&(v=Math.max(0,Math.min(v,k-1))),M!==void 0&&(M=Math.max(0,Math.min(M,P-1)));var F=m(this.props,this._instanceProps),D=w(this.props,this._instanceProps),A=D>j?W:0,H=F>N?W:0;this.scrollTo({scrollLeft:v!==void 0?S(this.props,v,u,O,this._instanceProps,H):O,scrollTop:M!==void 0?I(this.props,M,u,_,this._instanceProps,A):_})},x.componentDidMount=function(){var n=this.props,a=n.initialScrollLeft,u=n.initialScrollTop;if(this._outerRef!=null){var v=this._outerRef;typeof a=="number"&&(v.scrollLeft=a),typeof u=="number"&&(v.scrollTop=u)}this._callPropsCallbacks()},x.componentDidUpdate=function(){var n=this.props.direction,a=this.state,u=a.scrollLeft,v=a.scrollTop,M=a.scrollUpdateWasRequested;if(M&&this._outerRef!=null){var y=this._outerRef;if(n==="rtl")switch(ne()){case"negative":y.scrollLeft=-u;break;case"positive-ascending":y.scrollLeft=u;break;default:var k=y.clientWidth,N=y.scrollWidth;y.scrollLeft=N-k-u;break}else y.scrollLeft=Math.max(0,u);y.scrollTop=Math.max(0,v)}this._callPropsCallbacks()},x.componentWillUnmount=function(){this._resetIsScrollingTimeoutId!==null&&te(this._resetIsScrollingTimeoutId)},x.render=function(){var n=this.props,a=n.children,u=n.className,v=n.columnCount,M=n.direction,y=n.height,k=n.innerRef,N=n.innerElementType,P=n.innerTagName,j=n.itemData,L=n.itemKey,O=L===void 0?Ae:L,_=n.outerElementType,W=n.outerTagName,F=n.rowCount,D=n.style,A=n.useIsScrolling,H=n.width,U=this.state.isScrolling,E=this._getHorizontalRangeToRender(),$=E[0],Se=E[1],ae=this._getVerticalRangeToRender(),we=ae[0],ye=ae[1],ce=[];if(v>0&&F)for(var Q=we;Q<=ye;Q++)for(var X=$;X<=Se;X++)ce.push(z.createElement(a,{columnIndex:X,data:j,isScrolling:A?U:void 0,key:O({columnIndex:X,data:j,rowIndex:Q}),rowIndex:Q,style:this._getItemStyle(Q,X)}));var Ie=m(this.props,this._instanceProps),Ce=w(this.props,this._instanceProps);return z.createElement(_||W||"div",{className:u,onScroll:this._onScroll,ref:this._outerRefSetter,style:q({position:"relative",height:y,width:H,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:M},D)},z.createElement(N||P||"div",{children:ce,ref:k,style:{height:Ie,pointerEvents:U?"none":void 0,width:Ce}}))},x._callPropsCallbacks=function(){var n=this.props,a=n.columnCount,u=n.onItemsRendered,v=n.onScroll,M=n.rowCount;if(typeof u=="function"&&a>0&&M>0){var y=this._getHorizontalRangeToRender(),k=y[0],N=y[1],P=y[2],j=y[3],L=this._getVerticalRangeToRender(),O=L[0],_=L[1],W=L[2],F=L[3];this._callOnItemsRendered(k,N,O,_,P,j,W,F)}if(typeof v=="function"){var D=this.state,A=D.horizontalScrollDirection,H=D.scrollLeft,U=D.scrollTop,E=D.scrollUpdateWasRequested,$=D.verticalScrollDirection;this._callOnScroll(H,U,A,$,E)}},x._getHorizontalRangeToRender=function(){var n=this.props,a=n.columnCount,u=n.overscanColumnCount,v=n.overscanColumnsCount,M=n.overscanCount,y=n.rowCount,k=this.state,N=k.horizontalScrollDirection,P=k.isScrolling,j=k.scrollLeft,L=u||v||M||1;if(a===0||y===0)return[0,0,0,0];var O=o(this.props,j,this._instanceProps),_=l(this.props,O,j,this._instanceProps),W=!P||N==="backward"?Math.max(1,L):1,F=!P||N==="forward"?Math.max(1,L):1;return[Math.max(0,O-W),Math.max(0,Math.min(a-1,_+F)),O,_]},x._getVerticalRangeToRender=function(){var n=this.props,a=n.columnCount,u=n.overscanCount,v=n.overscanRowCount,M=n.overscanRowsCount,y=n.rowCount,k=this.state,N=k.isScrolling,P=k.verticalScrollDirection,j=k.scrollTop,L=v||M||u||1;if(a===0||y===0)return[0,0,0,0];var O=g(this.props,j,this._instanceProps),_=T(this.props,O,j,this._instanceProps),W=!N||P==="backward"?Math.max(1,L):1,F=!N||P==="forward"?Math.max(1,L):1;return[Math.max(0,O-W),Math.max(0,Math.min(y-1,_+F)),O,_]},h}(z.PureComponent),e.defaultProps={direction:"ltr",itemData:void 0,useIsScrolling:!1},e}var Ue=function(e,r){e.children,e.direction,e.height,e.innerTagName,e.outerTagName,e.overscanColumnsCount,e.overscanCount,e.overscanRowsCount,e.width,r.instance},$e=150,Be=function(e,r){return e};function Ve(t){var e,r=t.getItemOffset,o=t.getEstimatedTotalSize,l=t.getItemSize,p=t.getOffsetForIndexAndAlignment,m=t.getStartIndexForOffset,w=t.getStopIndexForStartIndex,S=t.initInstanceProps,I=t.shouldResetStyleCacheOnItemSizeChange,b=t.validateProps;return e=function(f){pe(g,f);function g(R){var i;return i=f.call(this,R)||this,i._instanceProps=S(i.props,ee(i)),i._outerRef=void 0,i._resetIsScrollingTimeoutId=null,i.state={instance:ee(i),isScrolling:!1,scrollDirection:"forward",scrollOffset:typeof i.props.initialScrollOffset=="number"?i.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},i._callOnItemsRendered=void 0,i._callOnItemsRendered=G(function(s,d,h,x){return i.props.onItemsRendered({overscanStartIndex:s,overscanStopIndex:d,visibleStartIndex:h,visibleStopIndex:x})}),i._callOnScroll=void 0,i._callOnScroll=G(function(s,d,h){return i.props.onScroll({scrollDirection:s,scrollOffset:d,scrollUpdateWasRequested:h})}),i._getItemStyle=void 0,i._getItemStyle=function(s){var d=i.props,h=d.direction,x=d.itemSize,C=d.layout,n=i._getItemStyleCache(I&&x,I&&C,I&&h),a;if(n.hasOwnProperty(s))a=n[s];else{var u=r(i.props,s,i._instanceProps),v=l(i.props,s,i._instanceProps),M=h==="horizontal"||C==="horizontal",y=h==="rtl",k=M?u:0;n[s]=a={position:"absolute",left:y?void 0:k,right:y?k:void 0,top:M?0:u,height:M?"100%":v,width:M?v:"100%"}}return a},i._getItemStyleCache=void 0,i._getItemStyleCache=G(function(s,d,h){return{}}),i._onScrollHorizontal=function(s){var d=s.currentTarget,h=d.clientWidth,x=d.scrollLeft,C=d.scrollWidth;i.setState(function(n){if(n.scrollOffset===x)return null;var a=i.props.direction,u=x;if(a==="rtl")switch(ne()){case"negative":u=-x;break;case"positive-descending":u=C-h-x;break}return u=Math.max(0,Math.min(u,C-h)),{isScrolling:!0,scrollDirection:n.scrollOffset<u?"forward":"backward",scrollOffset:u,scrollUpdateWasRequested:!1}},i._resetIsScrollingDebounced)},i._onScrollVertical=function(s){var d=s.currentTarget,h=d.clientHeight,x=d.scrollHeight,C=d.scrollTop;i.setState(function(n){if(n.scrollOffset===C)return null;var a=Math.max(0,Math.min(C,x-h));return{isScrolling:!0,scrollDirection:n.scrollOffset<a?"forward":"backward",scrollOffset:a,scrollUpdateWasRequested:!1}},i._resetIsScrollingDebounced)},i._outerRefSetter=function(s){var d=i.props.outerRef;i._outerRef=s,typeof d=="function"?d(s):d!=null&&typeof d=="object"&&d.hasOwnProperty("current")&&(d.current=s)},i._resetIsScrollingDebounced=function(){i._resetIsScrollingTimeoutId!==null&&te(i._resetIsScrollingTimeoutId),i._resetIsScrollingTimeoutId=ge(i._resetIsScrolling,$e)},i._resetIsScrolling=function(){i._resetIsScrollingTimeoutId=null,i.setState({isScrolling:!1},function(){i._getItemStyleCache(-1,null)})},i}g.getDerivedStateFromProps=function(i,s){return Ke(i,s),b(i),null};var T=g.prototype;return T.scrollTo=function(i){i=Math.max(0,i),this.setState(function(s){return s.scrollOffset===i?null:{scrollDirection:s.scrollOffset<i?"forward":"backward",scrollOffset:i,scrollUpdateWasRequested:!0}},this._resetIsScrollingDebounced)},T.scrollToItem=function(i,s){s===void 0&&(s="auto");var d=this.props,h=d.itemCount,x=d.layout,C=this.state.scrollOffset;i=Math.max(0,Math.min(i,h-1));var n=0;if(this._outerRef){var a=this._outerRef;x==="vertical"?n=a.scrollWidth>a.clientWidth?le():0:n=a.scrollHeight>a.clientHeight?le():0}this.scrollTo(p(this.props,i,s,C,this._instanceProps,n))},T.componentDidMount=function(){var i=this.props,s=i.direction,d=i.initialScrollOffset,h=i.layout;if(typeof d=="number"&&this._outerRef!=null){var x=this._outerRef;s==="horizontal"||h==="horizontal"?x.scrollLeft=d:x.scrollTop=d}this._callPropsCallbacks()},T.componentDidUpdate=function(){var i=this.props,s=i.direction,d=i.layout,h=this.state,x=h.scrollOffset,C=h.scrollUpdateWasRequested;if(C&&this._outerRef!=null){var n=this._outerRef;if(s==="horizontal"||d==="horizontal")if(s==="rtl")switch(ne()){case"negative":n.scrollLeft=-x;break;case"positive-ascending":n.scrollLeft=x;break;default:var a=n.clientWidth,u=n.scrollWidth;n.scrollLeft=u-a-x;break}else n.scrollLeft=x;else n.scrollTop=x}this._callPropsCallbacks()},T.componentWillUnmount=function(){this._resetIsScrollingTimeoutId!==null&&te(this._resetIsScrollingTimeoutId)},T.render=function(){var i=this.props,s=i.children,d=i.className,h=i.direction,x=i.height,C=i.innerRef,n=i.innerElementType,a=i.innerTagName,u=i.itemCount,v=i.itemData,M=i.itemKey,y=M===void 0?Be:M,k=i.layout,N=i.outerElementType,P=i.outerTagName,j=i.style,L=i.useIsScrolling,O=i.width,_=this.state.isScrolling,W=h==="horizontal"||k==="horizontal",F=W?this._onScrollHorizontal:this._onScrollVertical,D=this._getRangeToRender(),A=D[0],H=D[1],U=[];if(u>0)for(var E=A;E<=H;E++)U.push(z.createElement(s,{data:v,key:y(E,v),index:E,isScrolling:L?_:void 0,style:this._getItemStyle(E)}));var $=o(this.props,this._instanceProps);return z.createElement(N||P||"div",{className:d,onScroll:F,ref:this._outerRefSetter,style:q({position:"relative",height:x,width:O,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:h},j)},z.createElement(n||a||"div",{children:U,ref:C,style:{height:W?"100%":$,pointerEvents:_?"none":void 0,width:W?$:"100%"}}))},T._callPropsCallbacks=function(){if(typeof this.props.onItemsRendered=="function"){var i=this.props.itemCount;if(i>0){var s=this._getRangeToRender(),d=s[0],h=s[1],x=s[2],C=s[3];this._callOnItemsRendered(d,h,x,C)}}if(typeof this.props.onScroll=="function"){var n=this.state,a=n.scrollDirection,u=n.scrollOffset,v=n.scrollUpdateWasRequested;this._callOnScroll(a,u,v)}},T._getRangeToRender=function(){var i=this.props,s=i.itemCount,d=i.overscanCount,h=this.state,x=h.isScrolling,C=h.scrollDirection,n=h.scrollOffset;if(s===0)return[0,0,0,0];var a=m(this.props,n,this._instanceProps),u=w(this.props,a,n,this._instanceProps),v=!x||C==="backward"?Math.max(1,d):1,M=!x||C==="forward"?Math.max(1,d):1;return[Math.max(0,a-v),Math.max(0,Math.min(s-1,u+M)),a,u]},g}(z.PureComponent),e.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},e}var Ke=function(e,r){e.children,e.direction,e.height,e.layout,e.innerTagName,e.outerTagName,e.width,r.instance},Ge=He({getColumnOffset:function(e,r){var o=e.columnWidth;return r*o},getColumnWidth:function(e,r){var o=e.columnWidth;return o},getRowOffset:function(e,r){var o=e.rowHeight;return r*o},getRowHeight:function(e,r){var o=e.rowHeight;return o},getEstimatedTotalHeight:function(e){var r=e.rowCount,o=e.rowHeight;return o*r},getEstimatedTotalWidth:function(e){var r=e.columnCount,o=e.columnWidth;return o*r},getOffsetForColumnAndAlignment:function(e,r,o,l,p,m){var w=e.columnCount,S=e.columnWidth,I=e.width,b=Math.max(0,w*S-I),f=Math.min(b,r*S),g=Math.max(0,r*S-I+m+S);switch(o==="smart"&&(l>=g-I&&l<=f+I?o="auto":o="center"),o){case"start":return f;case"end":return g;case"center":var T=Math.round(g+(f-g)/2);return T<Math.ceil(I/2)?0:T>b+Math.floor(I/2)?b:T;case"auto":default:return l>=g&&l<=f?l:g>f||l<g?g:f}},getOffsetForRowAndAlignment:function(e,r,o,l,p,m){var w=e.rowHeight,S=e.height,I=e.rowCount,b=Math.max(0,I*w-S),f=Math.min(b,r*w),g=Math.max(0,r*w-S+m+w);switch(o==="smart"&&(l>=g-S&&l<=f+S?o="auto":o="center"),o){case"start":return f;case"end":return g;case"center":var T=Math.round(g+(f-g)/2);return T<Math.ceil(S/2)?0:T>b+Math.floor(S/2)?b:T;case"auto":default:return l>=g&&l<=f?l:g>f||l<g?g:f}},getColumnStartIndexForOffset:function(e,r){var o=e.columnWidth,l=e.columnCount;return Math.max(0,Math.min(l-1,Math.floor(r/o)))},getColumnStopIndexForStartIndex:function(e,r,o){var l=e.columnWidth,p=e.columnCount,m=e.width,w=r*l,S=Math.ceil((m+o-w)/l);return Math.max(0,Math.min(p-1,r+S-1))},getRowStartIndexForOffset:function(e,r){var o=e.rowHeight,l=e.rowCount;return Math.max(0,Math.min(l-1,Math.floor(r/o)))},getRowStopIndexForStartIndex:function(e,r,o){var l=e.rowHeight,p=e.rowCount,m=e.height,w=r*l,S=Math.ceil((m+o-w)/l);return Math.max(0,Math.min(p-1,r+S-1))},initInstanceProps:function(e){},shouldResetStyleCacheOnItemSizeChange:!0,validateProps:function(e){e.columnWidth,e.rowHeight}}),Qe=Ve({getItemOffset:function(e,r){var o=e.itemSize;return r*o},getItemSize:function(e,r){var o=e.itemSize;return o},getEstimatedTotalSize:function(e){var r=e.itemCount,o=e.itemSize;return o*r},getOffsetForIndexAndAlignment:function(e,r,o,l,p,m){var w=e.direction,S=e.height,I=e.itemCount,b=e.itemSize,f=e.layout,g=e.width,T=w==="horizontal"||f==="horizontal",R=T?g:S,i=Math.max(0,I*b-R),s=Math.min(i,r*b),d=Math.max(0,r*b-R+b+m);switch(o==="smart"&&(l>=d-R&&l<=s+R?o="auto":o="center"),o){case"start":return s;case"end":return d;case"center":{var h=Math.round(d+(s-d)/2);return h<Math.ceil(R/2)?0:h>i+Math.floor(R/2)?i:h}case"auto":default:return l>=d&&l<=s?l:l<d?d:s}},getStartIndexForOffset:function(e,r){var o=e.itemCount,l=e.itemSize;return Math.max(0,Math.min(o-1,Math.floor(r/l)))},getStopIndexForStartIndex:function(e,r,o){var l=e.direction,p=e.height,m=e.itemCount,w=e.itemSize,S=e.layout,I=e.width,b=l==="horizontal"||S==="horizontal",f=r*w,g=b?I:p,T=Math.ceil((g+o-f)/w);return Math.max(0,Math.min(m-1,r+T-1))},initInstanceProps:function(e){},shouldResetStyleCacheOnItemSizeChange:!0,validateProps:function(e){e.itemSize}});function ve(){const t=z.useRef(null),[e,r]=z.useState({width:0,height:0});return z.useEffect(()=>{const o=t.current;if(!o)return;const l=()=>r({width:Math.round(o.clientWidth),height:Math.round(o.clientHeight)}),p=new ResizeObserver(()=>l());return p.observe(o),l(),window.addEventListener("orientationchange",l),()=>{window.removeEventListener("orientationchange",l),p.disconnect()}},[]),[t,e]}function Xe({items:t}){const[e,{width:r,height:o}]=ve(),l=16,p=16,m=240,S=Math.round(m*1.45965417867),I=m,b=S+p*2,f=I+l,g=b+l,T=Math.max(1,Math.floor((r+l)/(m+l))),R=Math.ceil(t.length/T),i=Math.max(240,o||800),s=Math.max(320,r||1200),d=z.useMemo(()=>({columnIndex:h,rowIndex:x,style:C})=>{const n=x*T+h,a=t[n];return a?c.jsx("div",{style:{...C,padding:l/2,boxSizing:"border-box"},children:c.jsx("div",{style:{width:I,height:b},children:c.jsx(Te,{card:a,imageHeight:S})})}):c.jsx("div",{style:C})},[t,T,l,I,b,S]);return c.jsx("div",{ref:e,className:"w-full h-full cards-grid",children:c.jsx(Ge,{columnCount:T,columnWidth:f,height:i,rowCount:R,rowHeight:g,width:s,style:{overflowX:"hidden"},children:d})})}function xe(t){var e,r,o="";if(typeof t=="string"||typeof t=="number")o+=t;else if(typeof t=="object")if(Array.isArray(t)){var l=t.length;for(e=0;e<l;e++)t[e]&&(r=xe(t[e]))&&(o&&(o+=" "),o+=r)}else for(r in t)t[r]&&(o&&(o+=" "),o+=r);return o}function Je(){for(var t,e,r=0,o="",l=arguments.length;r<l;r++)(t=arguments[r])&&(e=xe(t))&&(o&&(o+=" "),o+=e);return o}const Ye=1.45965417867;function K({children:t}){return c.jsx("span",{className:"inline-flex items-center rounded-md border border-neutral-700 px-2 py-0.5 text-[11px] leading-none text-neutral-300",children:t})}function Ze({card:t}){const e=t.category==="Monster",r=96,o=Math.round(r*Ye),{open:l}=be(),p=Re(t.image);return c.jsx("div",{className:"list-row rounded-2xl bg-neutral-900 shadow-soft p-3 transition",children:c.jsxs("div",{className:"grid grid-cols-[auto,1fr,auto] gap-3 items-start",children:[c.jsx("button",{type:"button",className:"card-image rounded-xl cursor-zoom-in",style:{width:r,height:o},onClick:()=>l(p,t.name),title:"Click to enlarge",children:c.jsx("img",{src:p,alt:t.name,className:"w-full h-full object-contain rounded-xl",loading:"lazy"})}),c.jsxs("div",{className:"min-w-0",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("h3",{className:"font-semibold tracking-wide uppercase text-sm truncate",children:t.name}),c.jsxs("div",{className:"flex items-center gap-1 flex-wrap",children:[e&&t.attribute&&c.jsx(K,{children:t.attribute}),!e&&(t.icon||"Normal")&&c.jsx(K,{children:t.icon||"Normal"}),e&&(t.level!=null||t.rank!=null||t.linkRating!=null)&&c.jsxs(K,{children:[t.level!=null&&c.jsxs(c.Fragment,{children:["Level ",t.level]}),t.rank!=null&&c.jsxs(c.Fragment,{children:["Rank ",t.rank]}),t.linkRating!=null&&c.jsxs(c.Fragment,{children:["Link ",t.linkRating]})]}),e&&t.monsterType?.length?c.jsx(K,{children:t.monsterType.join(" / ")}):c.jsxs(K,{children:[t.category,t.cardTypes?.length?` • ${t.cardTypes.join(" / ")}`:""]}),t.scale!=null&&c.jsxs(K,{children:["Scale ",t.scale]})]})]}),t.text&&c.jsx("p",{className:"text-sm text-neutral-300 mt-1 line-clamp-3",children:t.text}),c.jsxs("div",{className:"text-[12px] text-neutral-400 mt-1",children:[t.archetype&&c.jsx("span",{children:t.archetype}),t.set&&c.jsx("span",{className:Je(t.archetype&&"before:content-['•'] before:mx-1"),children:t.set})]})]}),c.jsxs("div",{className:"flex flex-col items-end gap-2 pl-2",children:[e?c.jsx("div",{className:"text-xs text-neutral-200",children:c.jsxs("span",{className:"inline-block min-w-[120px] text-right",children:["ATK ",t.atk??"-"," / DEF ",t.def??"-"]})}):c.jsx("div",{className:"text-xs text-neutral-400",children:"Spell/Trap"}),t.legal?.banned&&c.jsx("span",{className:"text-[11px] rounded-md px-2 py-0.5 bg-red-700/30 text-red-300 border border-red-700/60",children:"BANNED"}),!t.legal?.banned&&t.legal?.limited&&c.jsx("span",{className:"text-[11px] rounded-md px-2 py-0.5 bg-orange-700/30 text-orange-300 border border-orange-700/60",children:"LIMITED"}),!t.legal?.banned&&!t.legal?.limited&&t.legal?.semiLimited&&c.jsx("span",{className:"text-[11px] rounded-md px-2 py-0.5 bg-yellow-700/30 text-yellow-300 border border-yellow-700/60",children:"SEMI"})]})]})})}function qe({items:t}){const[e,{width:r,height:o}]=ve(),l=176,p=12,m=z.useMemo(()=>({index:I,style:b})=>{const f=t[I];return c.jsx("div",{style:{...b,top:b.top+p/2,height:l-p},children:c.jsx(Ze,{card:f})})},[t]),w=Math.max(240,o||800),S=Math.max(320,r||1200);return c.jsx("div",{ref:e,className:"w-full h-full",children:c.jsx(Qe,{height:w,itemCount:t.length,itemSize:l,width:S,children:m})})}function it(){const{cards:t,loading:e,error:r}=fe(),[o]=se(),l=s=>o.getAll(s),p=s=>{const d=o.get(s);if(d==null||d==="")return;const h=Number(d);return Number.isFinite(h)?h:void 0},m=o.get("q")||"",w=["name","atk","def","level","rank","link","date"],S=o.get("sort")||"name",I=w.includes(S)?S:"name",b=I==="name"?"asc":"desc",f=o.get("dir")||b,g=f==="asc"||f==="desc"?f:b,T=o.get("view")||"grid",R=z.useMemo(()=>{const s=o.get("category")||"",d=o.get("set")?[o.get("set")]:[],h={q:m||void 0,set:d,archetype:l("archetype"),category:s,icon:l("icon").length?l("icon"):o.get("icon")?[o.get("icon")]:[],cardTypes:l("cardTypes"),monsterType:l("monsterType"),attribute:l("attribute").length?l("attribute"):o.get("attribute")?[o.get("attribute")]:[],levelMin:p("levelMin"),levelMax:p("levelMax"),rankMin:p("rankMin"),rankMax:p("rankMax"),linkMin:p("linkMin"),linkMax:p("linkMax"),scaleMin:p("scaleMin"),scaleMax:p("scaleMax"),atkMin:p("atkMin"),atkMax:p("atkMax"),defMin:p("defMin"),defMax:p("defMax"),legal:l("legal"),linkArrows:l("linkArrows"),sort:I,view:T};return["archetype","icon","cardTypes","monsterType","attribute","legal","linkArrows"].forEach(x=>{const C=h[x];C&&C.length===0&&delete h[x]}),h.set?.length||delete h.set,h.category||delete h.category,h},[o]),i=z.useMemo(()=>{if(e||r)return[];let s=t;m&&(s=Oe(t).search(m).map(x=>x.item));const d=s.filter(h=>Le(h,R));return Pe(d,I,g)},[t,e,r,m,R,I,g]);return e?c.jsx("div",{className:"p-6",children:"Loading…"}):r?c.jsx("div",{className:"p-6 text-red-600",children:"Failed to load cards."}):c.jsxs("div",{children:[c.jsx(ze,{}),c.jsx(_e,{total:i.length}),T==="list"?c.jsx(qe,{items:i}):c.jsx("div",{className:"h-[calc(100vh-12rem)]",children:c.jsx(Xe,{items:i})})]})}export{it as default};
